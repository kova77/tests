var config={basepath:"../"},mapModel=function(n){var e={},a=new google.maps.Geocoder,t=google.maps.GeocoderStatus.OK,i=new google.maps.InfoWindow({content:'<div id="info-window">Maker</div>'});e.getInfos=function(n,e){var a,t,i={};n&&(a=n.getSouthWest(),t=n.getNorthEast(),i.from={x:a.lat(),y:a.lng()},i.to={x:t.lat(),y:t.lng()}),e.apply(this,[latLngs])},e.newLatLng=function(n){return new google.maps.LatLng(n.x,n.y)},e.find=function(n,e,i){a.geocode({address:n},function(n,a){a===t?e.apply(this,[n]):i.apply(this,[a])})},e.drawInfos=function(a){n.each(a,function(a,t){var s=new google.maps.LatLng(t.x,t.y),p=new google.maps.Marker({position:s,title:"N"});p.setMap(e.map),google.maps.event.addListener(p,"click",function(){n.data(document.forms.info,"target-info",t),e.map.panTo(s);var l='<div class="info-window">';if(l+='<div class="info-window-header"><h4>'+t.title+"<div class='btn-group pull-right'><button type='button' data-info-idx='"+a+"' data-toggle='modal' data-target='#myModal' class='btn btn-xs btn-default btn-edit'><span class='glyphicon glyphicon-pencil'></span></button><button type='button' data-info-idx='"+a+"' class='btn btn-xs btn-default btn-star'><span class='glyphicon glyphicon-star'></span></button></div></h4></div><div class=\"info-window-body\"><p>緯度：<span>"+t.x+"</span>　経度：<span>"+t.y+"</span></div>",t.imgs){l+="<div class='info-window-photos'>";for(var o=0,g=t.imgs.length;g>o;o++)l+='<img height="60px" src="'+t.imgs[o]+'" class="img-thumbnail" style="height:100px;">';l+="</div>"}i.setContent(l),i.open(e.map,p)})})};var s={x:35.65748803011274,y:139.79381561279297},p=new google.maps.LatLng(s.x,s.y),l={center:p,zoom:17,mapTypeId:google.maps.MapTypeId.ROADMAP};e.map=new google.maps.Map(document.getElementById("map_canvas"),l);var o={x:s.x+1e-5,y:s.y+1e-4},g=new google.maps.Marker({position:new google.maps.LatLng(o.x,o.y),title:"Y"});g.setMap(e.map);var m=new google.maps.Marker({position:p,title:"X"});return m.setMap(e.map),google.maps.event.addListener(e.map,"bounds_changed",function(){var n=e.map.getBounds();e.getInfos(n,function(n){e.drawInfos(n)})}),google.maps.event.addListener(e.map,"click",function(n){console.log("{x:"+n.latLng.d+",y:"+n.latLng.e+"}")}),e}(jQuery);jQuery(function(n){n("#search").on("submit",function(n){n.preventDefault();var e=this.q.value;return e?(mapModel.find(e,function(n){mapModel.map.setCenter(n[0].geometry.location);mapModel.map.getBounds(),new google.maps.Marker({map:mapModel.map,position:n[0].geometry.location})},function(){alert("["+e+"]が見つかりませんでした。reason: "+status)}),void 0):!1}),n("body").on("click",".btn-edit",function(e){e.preventDefault();var a=(n(this).attr("data-info-idx"),n.data(document.forms.info,"target-info")),t=n(document.forms.info);t.find("#info-name").val(a.title),t.find(".x").text(a.x),t.find(".y").text(a.y),t.find("#info-cmt").val(a.cmt)}).on("submit","[name=info]",function(){})});var latLngs=[{x:"35.6594406935171",y:"139.792056083679",title:"西101-1",imgs:["../public/images/samples/1.png","../public/images/samples/2.png"],rank:"1"},{x:"35.6587825466773",y:"139.792002439498",title:"東101-2",imgs:["../public/images/samples/2.png"],rank:"2"},{x:"35.6582246431215",y:"139.792608618736",title:"北101-3",imgs:["../public/images/samples/3.png"],rank:"3"},{x:"35.6579936350393",y:"139.792742729187",title:"南101-4",imgs:["../public/images/samples/1.png"],rank:"4"},{x:"35.6578149302155",y:"139.792973399162",title:"西101-5",imgs:["../public/images/samples/1.png","../public/images/samples/2.png"],rank:"5"},{x:"35.6578236475333",y:"139.793601036071",title:"東101-6",imgs:["../public/images/samples/2.png"],rank:"1"},{x:"35.658311815809",y:"139.793139696121",title:"北101-7",imgs:["../public/images/samples/3.png"],rank:"2"},{x:"35.6584294987862",y:"139.79303240776",title:"南101-8",imgs:["../public/images/samples/1.png"],rank:"3"},{x:"35.6592837848292",y:"139.794405698776",title:"西101-9",imgs:["../public/images/samples/1.png","../public/images/samples/2.png"],rank:"4"},{x:"35.6588610015522",y:"139.793756604194",title:"東101-10",imgs:["../public/images/samples/2.png"],rank:"5"},{x:"35.6595496577023",y:"139.792909026145",title:"北101-11",imgs:["../public/images/samples/3.png"],rank:"1"},{x:"35.660120627602",y:"139.793579578399",title:"南101-12",imgs:["../public/images/samples/1.png"],rank:"2"},{x:"35.6564942455829",y:"139.795795083045",title:"西101-13",imgs:["../public/images/samples/1.png","../public/images/samples/2.png"],rank:"3"},{x:"35.6566991056864",y:"139.796127676963",title:"東101-14",imgs:["../public/images/samples/2.png"],rank:"4"},{x:"35.656982421985",y:"139.796503186225",title:"北101-15",imgs:["../public/images/samples/3.png"],rank:"5"},{x:"35.6561019588117",y:"139.794647097587",title:"南101-16",imgs:["../public/images/samples/1.png"],rank:"1"},{x:"35.6558709445894",y:"139.794850945472",title:"西101-17",imgs:["../public/images/samples/1.png","../public/images/samples/2.png"],rank:"2"},{x:"35.6556486472541",y:"139.794335961341",title:"東101-18",imgs:["../public/images/samples/2.png"],rank:"3"},{x:"35.6554219905104",y:"139.794083833694",title:"北101-19",imgs:["../public/images/samples/3.png"],rank:"4"},{x:"35.655260715128",y:"139.794191122055",title:"南101-20",imgs:["../public/images/samples/1.png"],rank:"5"},{x:"35.655443784456",y:"139.794491529464",title:"南101-21",imgs:["../public/images/samples/1.png","../public/images/samples/2.png"],rank:"5"},{x:"35.6556878762406",y:"139.794920682907",title:"南101-22",imgs:["../public/images/samples/2.png"],rank:"5"},{x:"35.6554394256674",y:"139.795355200767",title:"南101-23",imgs:["../public/images/samples/3.png"],rank:"5"},{x:"35.6551996919254",y:"139.79556441307",title:"南101-24",imgs:["../public/images/samples/1.png"],rank:"3"}];jQuery(function(n){n("#move").popover({html:!0,content:function(){return n(".move-content").html()}}),n("#pop").popover({html:!0,content:function(){return n(".pop-content").html()}})});